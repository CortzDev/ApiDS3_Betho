<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard Usuario</title>

  <link rel="stylesheet" href="/css/bootstrap.min.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body {
      background: linear-gradient(135deg, #4b79a1, #283e51);
      min-height: 100vh;
      padding: 40px 0;
      font-family: "Segoe UI", sans-serif;
    }

    .dashboard-card {
      background: #ffffffee;
      padding: 30px;
      border-radius: 12px;
      max-width: 950px;
      margin: auto;
      box-shadow: 0 12px 30px rgba(0,0,0,0.2);
      animation: fadeIn .4s ease-in-out;
    }

    .table {
      background: white;
      border-radius: 10px;
      overflow: hidden;
    }

    h2, h4, h3 { color: #333; font-weight: 600; }

    .btn-custom {
      background: #283e51;
      color: white;
      transition: .3s;
    }
    .btn-custom:hover { background:#4b79a1; color:white; }

    @keyframes fadeIn {
      from { opacity:0; transform:translateY(-8px); }
      to   { opacity:1; transform:translateY(0); }
    }

    /* ----------- MODAL GENÉRICO ----------- */
    .modal-overlay {
      position: fixed; top:0; left:0;
      width:100%; height:100%;
      background:rgba(0,0,0,0.6);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:2000;
    }
    .modal-box {
      width:480px;
      background:white;
      border-radius:10px;
      overflow:hidden;
      box-shadow:0 10px 25px rgba(0,0,0,0.25);
      animation:modalFade .25s;
    }
    .modal-header {
      background:#0d6efd;
      color:white;
      padding:15px;
      font-size:18px;
      font-weight:bold;
    }
    .modal-body { padding:20px; }
    .modal-footer {
      padding:15px;
      display:flex;
      justify-content:flex-end;
      gap:10px;
    }
    @keyframes modalFade {
      from { opacity:0; transform:scale(.95); }
      to   { opacity:1; transform:scale(1); }
    }

    /* salida del desencriptado */
    #decryptOutput {
      white-space: pre-wrap;
      background:#f3f3f3;
      padding:15px;
      border-radius:8px;
      max-height:300px;
      overflow-y:auto;
      display:none;
    }

  </style>
</head>

<body>

<div id="toastContainer" class="position-fixed top-0 end-0 p-3" style="z-index:9999;"></div>

<div class="dashboard-card">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Panel del Usuario</h2>

    <div>
      <button id="btnDecryptModal" class="btn btn-success me-2">Desencriptar Factura</button>
      <button id="btnRegistrarWallet" class="btn btn-warning me-2">Registrar Wallet</button>
      <button id="btnLogout" class="btn btn-danger">Cerrar sesión</button>
    </div>
  </div>

  <hr>

  <h4 class="mt-3">Productos disponibles</h4>

  <div class="table-responsive">
    <table class="table table-striped shadow-sm">
      <thead class="table-dark">
      <tr>
        <th>Producto</th><th>Descripción</th><th>Precio</th><th>Stock</th><th>Acción</th>
      </tr>
      </thead>
      <tbody id="tablaProductos"></tbody>
    </table>
  </div>

  <h4 class="mt-4">Carrito</h4>

  <div class="table-responsive">
    <table class="table table-bordered shadow-sm">
      <thead class="table-secondary">
      <tr><th>Producto</th><th>Cantidad</th><th>Subtotal</th></tr>
      </thead>
      <tbody id="tablaCarrito"></tbody>
    </table>
  </div>

  <h3 class="mt-3">Total: $<span id="total">0.00</span></h3>

  <button class="btn btn-custom w-100 mt-3" id="btnComprar">Registrar Venta</button>

</div>


<!-- ------------------- MODAL: INGRESAR PIN ------------------- -->
<div id="modalPin" class="modal-overlay">
  <div class="modal-box">
    <div class="modal-header">Ingrese su PIN</div>
    <div class="modal-body">
      <p>Ingresa tu PIN para autorizar la compra.</p>
      <input type="password" id="pinInput" class="form-control" maxlength="8" placeholder="PIN (4-8 dígitos)">
    </div>
    <div class="modal-footer">
      <button id="btnPinCancel" class="btn-secondary">Cancelar</button>
      <button id="btnPinContinue" class="btn-primary">Continuar</button>
    </div>
  </div>
</div>


<!-- ------------------- MODAL: REGISTRO WALLET ------------------- -->
<div id="modalCrearWallet" class="modal-overlay">
  <div class="modal-box">
    <div class="modal-header">Registrar Wallet</div>
    <div class="modal-body">

      <p>Sube tu <b>clave pública (.pem)</b> y crea un PIN.</p>

      <label>Clave Pública:</label>
      <input type="file" id="walletPubKey" class="form-control" accept=".pem,.txt">

      <label class="mt-3">Crear PIN:</label>
      <input type="password" id="walletPin" class="form-control" maxlength="8">
    </div>

    <div class="modal-footer">
      <button id="btnSaveWallet" class="btn-primary">Guardar Wallet</button>
    </div>
  </div>
</div>


<!-- ------------------- MODAL: DESENCRIPTAR FACTURA ------------------- -->
<div id="modalDecrypt" class="modal-overlay">
  <div class="modal-box" style="width:600px;">
    <div class="modal-header">Desencriptar Factura</div>

    <div class="modal-body">

      <label><b>Archivo .invoice</b></label>
      <input type="file" id="decryptInvoiceFile" class="form-control" accept=".invoice">

      <label class="mt-3"><b>Clave Privada (.pem)</b></label>
      <input type="file" id="decryptPrivateKey" class="form-control" accept=".pem,.key">

      <button id="btnDecryptStart" class="btn btn-primary w-100 mt-3">Desencriptar</button>

      <pre id="decryptOutput"></pre>

      <button id="btnDownloadPDF" class="btn btn-success w-100 mt-2" style="display:none;">
        Descargar PDF
      </button>

    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" id="closeDecryptModal">Cerrar</button>
    </div>
  </div>
</div>


<script src="/js/bootstrap.bundle.min.js"></script>
<script src="/js/usuario.js"></script>

</body>
</html>
